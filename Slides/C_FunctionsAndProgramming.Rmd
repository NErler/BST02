---
title: "BST02: Using R for Statistics\\ in Medical Research"
subtitle: "Part C: Functions and Programming"
author: ["Nicole Erler", "Eleni-Rosalina Andrinopoulou"]
institute: "Department of Biostatistics, Erasmus Medical Center"
date: "24 - 28 February 2020"
email: ["n.erler@erasmusmc.nl", "e.andrinopoulou@erasmusmc.nl"]
output:
  beamer_presentation: 
    template: mytemplate.latex
    includes:
      in_header: SlideTemplate.tex
    incremental: false
classoption: aspectratio=169
---

```{r setup, include=FALSE}
knitr::knit_hooks$set(
  nospace = function(before, options, envir) {
    if (before) {
      knitr::asis_output("\\vspace*{-1.5ex}")
    }
  }
)

knitr::opts_chunk$set(echo = TRUE, nospace = TRUE, nospaceafter = TRUE)

```

## Recap Part B
\begin{columns}[onlytextwidth,T]
\begin{column}{0.2\linewidth}
\blue{Objects}
\begin{itemize}
\item \texttt{vector}
\item \texttt{matrix}
\item \texttt{data.frame}
\item \texttt{list}
\end{itemize}

\bigskip

\blue{Operators}
\begin{itemize}
\item \texttt{+}, \texttt{-}, \texttt{*}, \texttt{/}
\item \texttt{<-}, \texttt{=}
\item \texttt{<}, \texttt{>}, \texttt{==}
\end{itemize}
\end{column}

\begin{column}{0.25\linewidth}
\blue{Data Structures}
\begin{itemize}
\item \texttt{numeric}
\item \texttt{character}
\item \texttt{integer}
\item \texttt{logical}
\item \texttt{factor}
\end{itemize}

\bigskip

\blue{Special Values}
\begin{itemize}
\item \texttt{NA}
\item \texttt{NaN}
\item \texttt{Inf}, \texttt{-Inf}
\end{itemize}
\end{column}

\begin{column}{0.5\linewidth}
\blue{Data Transformations}
\begin{itemize}
\item rounding (\texttt{format()})
\item convert to factor (\texttt{factor()})
\end{itemize}

\bigskip

\blue{Data Exploration}
\begin{itemize}
\item \texttt{mean()}, \texttt{median()}, \texttt{sd()}, \texttt{IQR()}, \ldots
\end{itemize}

\bigskip

\blue{Data Visualizations}
\begin{itemize}
\item plotting packages
\item plot types (\texttt{plot()}, \texttt{barplot()}, ...)
\end{itemize}

\bigskip

\blue{Subsetting}
\begin{itemize}
\item \texttt{[[...]]}, \texttt{[...]}, \ldots
\end{itemize}

\end{column}
\end{columns}


## In this Section

* What are functions?

* Useful functions for data exploration

* Useful functions for data manipulations

* Writing functions

* Control-flow constructs

* The `apply` family

* Lots of practicing


## Functions

Sometimes we want to perform the same action / manipulation on several objects.

* Option 1: copy & paste
  - a lot of work
  - susceptible to mistakes
  
* Option 2: \blue{functions}

\pause

\blue{What are functions?}
* a group of (organized) R commands
* a (small) programm with flexible (= not pre-specified) input

\vspace*{3ex}

**Almost all commands in R are functions!**

## Functions
\blue{Some examples:}
\begincols[t]
\begincol{0.3\linewidth}

* `mean()`
* `sum()`
* `plot()`
* ...

\endcol
\begincol{0.65\linewidth}
```{r, collapse=TRUE, nospace = TRUE}
class(mean)
class(sum)
class(plot)
```
\endcol
\endcols\vspace*{3ex}

\pause

Even `class()` is a function:
```{r}
class(class)
```

## Useful Functions for Data Exploration
Link to Demo: Functions_DataExploration.R



Link to Practical:



## Useful Functions for Data Exploration
\begin{columns}[onlytextwidth,T]
\begin{column}{0.28\linewidth}
\blue{Dimension}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{dim()}
\item \texttt{nrow()}, \texttt{ncol()}
\item \texttt{length()}
\end{itemize}

\bigskip

\blue{Data Structure}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{str()}
\item \texttt{names()}, 
\item \texttt{head()}, \texttt{tail()}
\item \texttt{is.data.frame()}, \texttt{is.list()}, \texttt{is.matrix()}
      \texttt{is.numeric()}, \texttt{is.ordered()}, \ldots
\end{itemize}

\end{column}

\begin{column}{0.32\linewidth}
\blue{Descriptives for Continuous Variables}
\begin{itemize}\vspace*{-1ex}
\item \texttt{summary()}
\item \texttt{min()}, \texttt{max()}, \texttt{range()}
\item \texttt{mean()}, \texttt{median()}, \texttt{quantile()}, \texttt{IQR()}
\item \texttt{sd()}, \texttt{var()}
\item \texttt{ave()}
\end{itemize}

\bigskip

\blue{Tables}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{table()}, \texttt{prop.table()}
\item \texttt{addmargins()}, \texttt{ftable()}
\end{itemize}
\end{column}


\begin{column}{0.36\linewidth}
\blue{for \texttt{matrix} \& \texttt{data.frame}}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{summary()}
\item \texttt{var()}, \texttt{cor()}, \texttt{cov2cor()}
\item \texttt{colSums()}, \texttt{colMeans()}, \texttt{rowSums()}, \texttt{rowMeans()}
\end{itemize}

\bigskip

\blue{Duplicates \& Comparison}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{duplicated()}
\item \texttt{unique()}
\end{itemize}

\end{column}
\end{columns}

## Useful functions for Data Manipulation

Link to Demo: Functions_DataManipulation.R

Link to practical

## Useful functions for Data Manipulation
\begin{columns}[onlytextwidth,T]
\begin{column}{0.35\linewidth}
\blue{Transformations}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{log()}, \texttt{log2()}, \texttt{log10()}
\item \texttt{exp()}, \texttt{sqrt()}, \texttt{plogis()}
\end{itemize}

\bigskip

\blue{Splitting \& Combining}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{split()}, \texttt{cut()}
\item \texttt{cbind()}, \texttt{rbind()}
\item \texttt{merge()}
\item \texttt{subset()}
\item \texttt{c()}
\item \texttt{paste()}
\end{itemize}
\end{column}

\begin{column}{0.35\linewidth}
\blue{repetition \& sequence}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{rep()}, \texttt{seq()}
\item \texttt{expand.grid()}
\end{itemize}

\bigskip

\blue{Transformation for objects}
\begin{itemize}
\item \texttt{t()}
\item \texttt{unlist()}, \texttt{unname()}
\item \texttt{as.numeric()}, \texttt{as.matrix()}, \texttt{as.data.frame()}
\end{itemize}
\end{column}

\begin{column}{0.3\linewidth}
\blue{Sorting}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{sort()}, \texttt{order()}, \texttt{rev()}, \texttt{rank()}
\end{itemize}

\bigskip

\blue{matrices}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{\%*\%}
\item \texttt{diag()}, \texttt{det()}, \texttt{solve()}
\item \texttt{upper.tri()}, \texttt{lower.tri()}
\end{itemize}

\end{column}
\end{columns}

## Writing Functions
To write your own function:
```{r, eval = FALSE}
myfun <- function(arguments) {
  syntax
}
```

For example:
```{r}
square <- function(x) {
  x^2
}
```

```{r}
square(3)
```

## Writing Functions
Functions do not always need an argument:
```{r}
random <- function() {
  rnorm(1)
}
```
```{r, collapse = TRUE}
random()
random()
random()
```

## Writing Functions
Functions can use multiple arguments:
```{r}
subtract <- function(x, y) {
  x - y
}
```
```{r}
subtract(x = 5.2, y = 3.3)
```


## Writing Functions
Multiple arguments are interpretet in the pre-defined order, unless they are named:
```{r}
subtract(5.2, 1.2)
subtract(y = 5.2, x = 1.2)
```

## Writing Functions
We can also define default values for arguments.
```{r}
multiply <- function(x, y = 2) {
  x * y
}
```

The default value is used when the user does not specify a value for that argument:
```{r}
multiply(x = 3, y = 3)
multiply(x = 3)
```


## Writing Functions
Link to Demo

Link to Practical


## Control-flow constructs

* `if(cond) expr`
* `if(cond) cons.expr else (alt.expr)`
* `ifelse()`
* `for`
* `while`
* `repeat`
* `break`
* `next`





```{r setup2, include=FALSE}
# This is the setup chunk for Elrozy's part of these slides
knitr::opts_chunk$set(echo = FALSE, comment = NA)

library(survival)
```


##  What is the apply Family

* Manipulate slices of data from matrices, arrays, lists and dataframes in a repetitive way avoiding explicit use of loop constructs
  - An aggregating function, like for example the mean, or the sum
  - Other transforming or subsetting functions
  - Other vectorized functions, which return more complex structures like lists, vectors, matrices and arrays
  
  
## What is the apply Family (cont'd)

\textbf{\textcolor{blue}{apply(), lapply() , sapply(), tapply(), mapply()}}

\vspace*{3ex} 

\textbf{But how and when should we use these?}


## How To Use apply() in R

* Operates on Matrices and Data Frames

\begincols[t]
\begincol{0.5\linewidth}
```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 2, sum)
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 1, sum)
```

\endcol
\endcols


## How To Use apply() in R (cont'd)

* Operates on Matrices and Data Frames

\begincols[t]
\begincol{0.5\linewidth}
```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 2, mean)
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 1, mean)
```

\endcol
\endcols


## How To Use apply() in R (cont'd)

* You can also apply your functions

\begincols[t]
\begincol{0.5\linewidth}
```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 2, function(x) 
          sum(x)/(length(x)-1))
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 1, function(x) 
          sum(x)/(length(x)-1))
```

\endcol
\endcols


## How To Use lapply() in R 

* Apply a given function to every element of a list and obtain a list as result
* The difference with apply():
  - It can be used for other objects like data frames, lists or vectors
  - The output returned is a list


## How To Use lapply() in R (cont'd)

\begincols[t]
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
myList
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
lapply(myList, length)
```

\endcol
\endcols


## How To Use lapply() in R (cont'd)

\begincols[t]
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
myList
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE, warning = FALSE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
lapply(myList, median)
```

\endcol
\endcols


## How To Use sapply() in R 

* sapply() is similar to lapply(), but it tries to simplify the output

\begincols[t]
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
myList
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE, warning = FALSE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
sapply(myList, length)
sapply(myList, median)
```

\endcol
\endcols


## How To Use tapply() in R

* Apply a function to subsets of a vector and the subsets are defined by some other vector, usually a factor

```{r, eval = TRUE, include = TRUE, echo = TRUE}
tapply(pbc$bili, pbc$sex, mean)
tapply(pbc$age, pbc$sex, median)
```


## How To Use tapply() in R (cont'd)

* You can also apply your functions

```{r, eval = TRUE, include = TRUE, echo = TRUE}
tapply(pbc$bili, pbc$sex, function(x) sum(x)/(length(x)-1))
```


## How To Use mapply() in R

* Multivariate apply
* Its purpose is to be able to vectorize arguments to a function that is not usually accepting vectors as arguments
* mapply() applies a function to multiple list or multiple vector arguments

```{r, eval = TRUE, include = TRUE, echo = TRUE}
mapply(length, pbc)
```


## How To Use mapply() in R (cont'd)

```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
mapply(length, myList, SIMPLIFY = FALSE)
```


## Useful Summary: Apply Family

\begin{columns}[onlytextwidth,T]
\begin{column}{0.5\linewidth}
\textbf{\textcolor{blue}{Vectors}}
\begin{itemize}\vspace*{-0.5ex}
\item \texttt{tapply()}
\item \texttt{sapply()}
\item \texttt{lapply()}
\item \texttt{mapply()}
\end{itemize}

\bigskip

\textbf{\textcolor{blue}{Matrices}}
\begin{itemize}
\item \texttt{apply()}
\item \texttt{tapply()}
\item \texttt{lapply()}
\item \texttt{sapply()}
\item \texttt{mapply()}
\end{itemize}
\end{column}


\begin{column}{0.5\linewidth}
\textbf{\textcolor{blue}{Data frames}}
\begin{itemize}
\item \texttt{apply()}
\item \texttt{tapply()}
\item \texttt{lapply()}
\item \texttt{sapply()}
\item \texttt{mapply()}
\end{itemize}

\bigskip

\textbf{\textcolor{blue}{Lists}}
\begin{itemize}
\item \texttt{lapply()}
\item \texttt{sapply()}
\item \texttt{mapply()}
\end{itemize}


\end{column}

\end{columns}

