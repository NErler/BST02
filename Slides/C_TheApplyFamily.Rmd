---
title: "BST02: Using R for Statistics\\ in Medical Research"
subtitle: "Part C: The apply family"
author: "Eleni-Rosalina Andrinopoulou"
institute: "Department of Biostatistics, Erasmus Medical Center"
date: "24 - 28 February 2020"
email: "e.andrinopoulou@erasmusmc.nl"
output:
  beamer_presentation: 
    template: mytemplate.latex
    includes:
      in_header: SlideTemplate.tex
    keep_tex: yes
    incremental: false
classoption: aspectratio=169
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, comment=NA)

library(survival)
```


## The apply Family

* Manipulate slices of data from matrices, arrays, lists and dataframes in a repetitive way avoiding explicit use of loop constructs
  - An aggregating function, like for example the mean, or the sum
  - Other transforming or subsetting functions
  - Other vectorized functions, which return more complex structures like lists, vectors, matrices and arrays
  
  
## The apply Family (cont'd)

\textbf{\textcolor{blue}{apply(), lapply() , sapply(), tapply(), mapply()}}

\vspace*{3ex} 

\textbf{But how and when should we use these?}


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use apply() in R}}

* Operates on Matrices and Data Frames

\begincols[t]
\begincol{0.5\linewidth}
```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 2, sum)
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 1, sum)
```

\endcol
\endcols


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use apply() in R}}

* Operates on Matrices and Data Frames

\begincols[t]
\begincol{0.5\linewidth}
```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 2, mean)
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 1, mean)
```

\endcol
\endcols


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use apply() in R}}

* You can also apply your functions

\begincols[t]
\begincol{0.5\linewidth}
```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 2, function(x) 
          sum(x)/(length(x)-1))
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
mat <- matrix(1:6, 3, 3)
mat
apply(mat, 1, function(x) 
          sum(x)/(length(x)-1))
```

\endcol
\endcols


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use lapply() in R}}

* Apply a given function to every element of a list and obtain a list as result
* The difference with apply():
  - It can be used for other objects like data frames, lists or vectors
  - The output returned is a list


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use lapply() in R}}

\begincols[t]
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
myList
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
lapply(myList, length)
```

\endcol
\endcols


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use lapply() in R}}

\begincols[t]
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
myList
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE, warning = FALSE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
lapply(myList, median)
```

\endcol
\endcols


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use sapply() in R}}

* sapply() is similar to lapply(), but it tries to simplify the output


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use sapply() in R}}

\begincols[t]
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
myList
```

\endcol
\begincol{0.5\linewidth}

```{r, eval = TRUE, include = TRUE, echo = TRUE, warning = FALSE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
sapply(myList, length)
sapply(myList, median)
```

\endcol
\endcols


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use tapply() in R}}

* Apply a function to subsets of a vector and the subsets are defined by some other vector, usually a factor

```{r, eval = TRUE, include = TRUE, echo = TRUE}
tapply(pbc$bili, pbc$sex, mean)
tapply(pbc$age, pbc$sex, median)
```


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use tapply() in R}}

* You can also apply your functions

```{r, eval = TRUE, include = TRUE, echo = TRUE}
tapply(pbc$bili, pbc$sex, function(x) sum(x)/(length(x)-1))
```


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use mapply() in R}}

* Multivariate apply
* Its purpose is to be able to vectorize arguments to a function that is not usually accepting vectors as arguments
* mapply() applies a function to multiple list or multiple vector arguments

```{r, eval = TRUE, include = TRUE, echo = TRUE}
mapply(length, pbc)
```


## The apply Family (cont'd)

\textbf{\textcolor{blue}{How To Use mapply() in R}}
```{r, eval = TRUE, include = TRUE, echo = TRUE}
myList <- list(x <- c(1:6), 
               y = c("m", "f"), 
               z = c(30, 4, 23))
mapply(length, myList, SIMPLIFY = FALSE)
```